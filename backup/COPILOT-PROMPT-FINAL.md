# ü§ñ GITHUB COPILOT PLAN PROMPT - Project Partnership Network

> **Use this prompt after completing CURRENT-STATE-FOR-COPILOT.md**

---

## üìã PROMPT FOR COPILOT

```
CURRENT SUPABASE DATABASE STATE:

# CURRENT SUPABASE STATE - FOR COPILOT CONTEXT

> **Export Date:** 2025-11-20  
> **Project:** Connet - Project Partnership Network  
> **Database:** Supabase PostgreSQL

---

## üìä EXECUTIVE SUMMARY

- **Total Tables:** 5 (users, user_roles, channels, messages, role_permissions)
- **Total Enums:** 2 (app_role, app_permission)
- **Total RPC Functions:** 22
- **Total Triggers:** 3 (auto_assign_role_on_signup, handle_new_auth_user, update_updated_at_column)
- **RLS Enabled:** Yes (all tables)
- **Auth Provider:** Supabase Auth
- **No Email Verification:** Users auto-confirmed

---

## üóÑÔ∏è COMPLETE TABLE SCHEMAS

> **Source:** Extracted from db_clusteer.backup + starting_point.json API documentation

### 1. `users` Table

```sql
-- Core user profiles table (synced from auth.users)
CREATE TABLE public.users (
    id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    email text UNIQUE NOT NULL,
    username text UNIQUE,
    full_name text,
    avatar_url text,
    projects text[],  -- Array of project names
    status text DEFAULT 'OFFLINE',  -- 'ONLINE' | 'OFFLINE'
    is_active boolean DEFAULT true NOT NULL,
    
    -- Professional/Academic Profile Fields
    bio text,
    institution text,
    department text,
    title text,  -- Job title / Academic position
    orcid_id text,  -- ORCID researcher ID
    linkedin_url text,
    website_url text,
    expertise_areas text[],  -- Array of expertise keywords
    skills text[],  -- Array of skill keywords
    location text,  -- Geographic location
    available_for_collaboration boolean DEFAULT false,
    
    -- Timestamps
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);

-- Indexes
CREATE UNIQUE INDEX users_email_idx ON public.users(email);
CREATE UNIQUE INDEX users_username_idx ON public.users(username);
CREATE INDEX users_institution_idx ON public.users(institution);
CREATE INDEX users_is_active_idx ON public.users(is_active);

-- RLS Enabled: YES
-- Policies defined below
```

### 2. `user_roles` Table

```sql
-- User role assignments (many-to-many relationship)
CREATE TABLE public.user_roles (
    user_id uuid NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
    role app_role NOT NULL,  -- Enum: admin, moderator, student, researcher, professor, user
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    PRIMARY KEY (user_id, role)
);

-- Indexes
CREATE INDEX user_roles_user_id_idx ON public.user_roles(user_id);
CREATE INDEX user_roles_role_idx ON public.user_roles(role);

-- RLS Enabled: YES
-- Policies defined below
```

### 3. `channels` Table

```sql
-- Communication channels for messaging
CREATE TABLE public.channels (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    slug text UNIQUE NOT NULL,  -- Channel identifier/name
    created_by uuid REFERENCES public.users(id) ON DELETE SET NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);

-- Indexes
CREATE UNIQUE INDEX channels_slug_idx ON public.channels(slug);
CREATE INDEX channels_created_by_idx ON public.channels(created_by);

-- RLS Enabled: YES
-- Policies defined below
```

### 4. `messages` Table

```sql
-- Messages within channels
CREATE TABLE public.messages (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    message text NOT NULL,
    user_id uuid NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
    channel_id bigint NOT NULL REFERENCES public.channels(id) ON DELETE CASCADE,
    inserted_at timestamp with time zone DEFAULT now() NOT NULL
);

-- Indexes
CREATE INDEX messages_channel_id_idx ON public.messages(channel_id);
CREATE INDEX messages_user_id_idx ON public.messages(user_id);
CREATE INDEX messages_inserted_at_idx ON public.messages(inserted_at DESC);

-- RLS Enabled: YES
-- Policies defined below
```

---

## üè∑Ô∏è ENUMS

### `app_role` Enum

```sql
-- Role types for user_roles table
CREATE TYPE app_role AS ENUM (
    'admin',        -- Full system access
    'moderator',    -- Content moderation access
    'student',      -- Student user (@ogrenci.karabuk.edu.tr)
    'researcher',   -- Researcher user (@karabuk.edu.tr)
    'professor',    -- Professor/academic user
    'user'          -- Default user role
);

-- Auto-assigned based on email domain:
-- @ogrenci.karabuk.edu.tr ‚Üí student
-- @karabuk.edu.tr ‚Üí researcher
-- @gmail.com, @outlook.com, etc. ‚Üí user
-- Manual override possible via admin functions
```

---

## üîó FOREIGN KEYS & RELATIONSHIPS

```sql
-- PASTE RESULTS FROM:
-- SELECT * FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY';

users.id -> auth.users.id (CASCADE DELETE)
user_roles.user_id -> users.id (CASCADE DELETE)
channels.created_by -> users.id
messages.user_id -> users.id
messages.channel_id -> channels.id

-- [PASTE COMPLETE FK DEFINITIONS]
```

---

## üìá INDEXES

```sql
-- PASTE RESULTS FROM:
-- SELECT * FROM pg_indexes WHERE schemaname = 'public';

-- [LIST ALL INDEXES]
```

---

## üîí ROW LEVEL SECURITY (RLS) POLICIES

### `users` Table Policies

```sql
-- PASTE FROM SUPABASE DASHBOARD OR:
-- SELECT * FROM pg_policies WHERE tablename = 'users';

-- Example:
-- Policy: "Users can view all profiles"
-- Operation: SELECT
-- Using: true

-- Policy: "Users can update own profile"
-- Operation: UPDATE
-- Using: auth.uid() = id

-- [PASTE ALL ACTUAL POLICIES]
```

### `user_roles` Table Policies

```sql
-- [PASTE ALL POLICIES]
```

### `channels` Table Policies

```sql
-- [PASTE ALL POLICIES]
```

### `messages` Table Policies

```sql
-- [PASTE ALL POLICIES]
```

---

## ‚öôÔ∏è RPC FUNCTIONS (Complete Definitions)

### 1. `check_database_setup()`

```sql
-- PASTE COMPLETE FUNCTION DEFINITION:
-- SELECT pg_get_functiondef(oid) FROM pg_proc WHERE proname = 'check_database_setup';

CREATE OR REPLACE FUNCTION public.check_database_setup()
RETURNS jsonb
LANGUAGE plpgsql
AS $$
-- [PASTE COMPLETE FUNCTION CODE]
$$;
```

### 2. `test_email_domains()`

```sql
-- [PASTE COMPLETE FUNCTION CODE]
```

### 3. `sync_specific_auth_user(target_user_id uuid)` ‚≠ê

```sql
-- [PASTE COMPLETE FUNCTION CODE]
-- This is critical for understanding user creation flow
```

### 4. `admin_create_complete_user()` ‚≠ê‚≠ê‚≠ê

```sql
-- [PASTE COMPLETE FUNCTION CODE]
-- MOST IMPORTANT - shows role detection, user creation pattern
```

### 5. `update_professional_profile()`

```sql
-- [PASTE COMPLETE FUNCTION CODE]
```

### 6. `search_users_by_expertise(search_term text)`

```sql
-- [PASTE COMPLETE FUNCTION CODE]
```

### 7. [Any Other RPC Functions]

```sql
-- [PASTE ALL OTHER FUNCTIONS]
```

---

## üé¨ TRIGGERS

### 1. `handle_new_user` Trigger

```sql
-- PASTE TRIGGER DEFINITION:
-- SELECT * FROM information_schema.triggers WHERE trigger_name = 'handle_new_user';

CREATE TRIGGER handle_new_user
    AFTER INSERT ON auth.users
    FOR EACH ROW
    EXECUTE FUNCTION public.handle_new_user_trigger();
```

### Trigger Function: `handle_new_user_trigger()`

```sql
-- PASTE COMPLETE TRIGGER FUNCTION:
CREATE OR REPLACE FUNCTION public.handle_new_user_trigger()
RETURNS trigger
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
-- [PASTE COMPLETE CODE]
-- This shows how users are auto-created and roles assigned
$$;
```

---

## üåê EDGE FUNCTIONS

```
List all Edge Functions from Supabase Dashboard:
1. [Function Name] - [Description]
2. [Function Name] - [Description]

If any exist, paste their TypeScript code here.
```

---

## üì° REALTIME CONFIGURATION

```
Which tables have Realtime enabled?
- channels: [YES/NO]
- messages: [YES/NO]
- users: [YES/NO]
- user_roles: [YES/NO]
```

---

## üíæ STORAGE BUCKETS (if any)

```sql
-- PASTE RESULT FROM:
-- SELECT * FROM storage.buckets;

-- Example:
-- avatars (public: true, file_size_limit: 5MB)
-- project-files (public: false)
```

---

## üîë AUTH CONFIGURATION

```
- Email Verification: DISABLED (auto-confirmed)
- Password Requirements: [PASTE FROM SUPABASE SETTINGS]
- JWT Expiry: [TIME]
- Refresh Token Rotation: [YES/NO]

Role Assignment Logic:
- @ogrenci.karabuk.edu.tr ‚Üí student
- @karabuk.edu.tr ‚Üí researcher
- @gmail.com/@outlook.com ‚Üí user
- Manual override via admin_create_complete_user
```

---

## üìä CURRENT DATA OVERVIEW

```sql
-- PASTE RESULTS:
SELECT 
    'users' as table_name, COUNT(*) as row_count 
FROM users
UNION ALL
SELECT 'user_roles', COUNT(*) FROM user_roles
UNION ALL
SELECT 'channels', COUNT(*) FROM channels
UNION ALL
SELECT 'messages', COUNT(*) FROM messages;

-- Current counts:
-- users: [COUNT]
-- user_roles: [COUNT]
-- channels: [COUNT]
-- messages: [COUNT]
```

---

## üîÑ CURRENT USER FLOW

### Signup Flow:
1. User calls `POST /auth/v1/signup` with email/password
2. Supabase creates auth.users record (auto-confirmed, no email verification)
3. Trigger `handle_new_user` fires automatically
4. Trigger creates public.users record
5. Trigger detects email domain and assigns role to user_roles table
6. Fallback: If trigger fails, frontend calls `sync_specific_auth_user()`

### Admin User Creation:
1. Admin calls `admin_create_complete_user()` RPC
2. Function detects role from email (or uses provided role override)
3. Function checks for duplicates (prevents duplicate key errors)
4. Function creates both public.users and user_roles records atomically
5. Returns success/error with complete user object

---

## üìù NOTES & CONSTRAINTS

- All users must have entry in both `auth.users` AND `public.users`
- User roles are stored separately in `user_roles` table (many-to-many possible)
- Profile updates use direct PATCH or `update_professional_profile()` RPC
- No email verification requirement (development mode)
- Duplicate prevention handled at function level
- Cascade deletes: auth.users ‚Üí users ‚Üí user_roles

---

## üéØ API PATTERNS (from starting_point.json)

### Authentication:
- `POST /auth/v1/signup` - Create account
- `POST /auth/v1/token?grant_type=password` - Login
- `POST /auth/v1/logout` - Logout

### User Management:
- `GET /rest/v1/users?select=*,user_roles(role)` - Get users with roles
- `PATCH /rest/v1/users?id=eq.{id}` - Update profile
- `POST /rest/v1/rpc/admin_create_complete_user` - Admin create user

### Messaging:
- `GET /rest/v1/channels` - List channels
- `POST /rest/v1/channels` - Create channel
- `GET /rest/v1/messages?channel_id=eq.{id}` - Get messages
- `POST /rest/v1/messages` - Send message

---

## ‚úÖ EXPORT CHECKLIST

- [ ] Run all SQL queries from `current-supabase-state.sql`
- [ ] Export complete table schemas
- [ ] Export all RLS policies
- [ ] Export all RPC function definitions
- [ ] Export all trigger definitions
- [ ] List Edge Functions (if any)
- [ ] Check Realtime configuration
- [ ] Document auth flow
- [ ] List current data counts
- [ ] Review and verify all exports

---

**Once completed, this file is ready for GitHub Copilot's plan feature!**


---

PROJECT CONTEXT:

I'm building a Project Partnership Network platform (Proje Ortaklƒ±k Aƒüƒ±) using:
- Frontend: Vue 3 + TypeScript + Vuestic UI + Pinia
- Backend: Supabase (PostgreSQL + REST API + Auth + Realtime)
- Testing: Postman collections (following starting_point.json pattern)

---

CURRENT FEATURES (WORKING):
‚úÖ Complete authentication system (signup, login, logout)
‚úÖ User profiles with professional fields (bio, institution, ORCID, skills, expertise)
‚úÖ Role-based access control (admin, moderator, student, researcher, professor, user)
‚úÖ Email domain-based role auto-detection
‚úÖ Messaging system (channels + messages)
‚úÖ Admin user management with RPC functions
‚úÖ Row Level Security policies
‚úÖ Auto-syncing auth.users to public.users

---

NEW FEATURES TO BUILD:

This platform enables academic collaboration through project listings. Users need to:

1. **üìù Create & Manage Project Listings (ƒ∞lan Y√∂netimi)**
   - Post project opportunities with rich details
   - Fields: title, description, field_type (dropdown), required_skills (array), 
     contact_info, start_date, end_date, status (active/closed/completed)
   - Project creator is the owner
   - Drafts vs published projects
   - Edit/delete own projects
   - Admins can manage all projects

2. **üîç Browse, Search & Filter Projects (Proje Tarama)**
   - Search by: project name, required skills, creator name
   - Filter by: field_type, date range, status
   - Sort by: newest, oldest, most applied, highest rated
   - Pagination support
   - Card view display with key info preview

3. **‚≠ê Favorite Projects (Favori Projeler)**
   - Users can favorite/unfavorite projects
   - View list of all favorited projects
   - Show favorite count on project cards
   - Quick access to favorites from navbar/sidebar
   - Notifications when favorited project changes status

4. **ü§ù Partnership Applications (Ortaklƒ±k Ba≈üvurularƒ±)**
   - Users apply to join projects with:
     * Application message/proposal
     * CV/portfolio link (optional)
     * Relevant skills they bring
   - Application statuses: pending, accepted, rejected, withdrawn
   - Project owners see all applications for their projects
   - Project owners can accept/reject applications
   - Applicants can view their application status
   - Applicants can withdraw pending applications
   - Admins can see all applications

5. **üí¨ Project-Specific Messaging (Proje Mesajla≈üma)**
   - Direct messaging between project owner and applicants
   - Use existing channels/messages infrastructure OR create project-specific chat
   - Thread-based conversations per project
   - Notification when new message arrives
   - Unread message indicator

6. **‚≠ê Rate & Review Projects (Deƒüerlendirme)**
   - Users can rate completed projects (1-5 stars)
   - Users can leave text review (optional)
   - Only users who participated can rate
   - Display average rating on project cards
   - Show rating breakdown (5 stars: X, 4 stars: Y, etc.)
   - Show recent reviews

7. **üîî Notifications System (Bildirimler)**
   - New application on user's project
   - Application status change (accepted/rejected)
   - New message about project
   - Favorited project status change
   - Project deadline approaching
   - New matching project (based on skills)
   - Mark as read/unread
   - Notification history
   - Real-time updates

---

IMPLEMENTATION REQUIREMENTS:

üìê **Database Design:**
- Extend existing schema (DON'T recreate users/channels/messages)
- Follow same naming conventions (lowercase, underscores)
- Use UUIDs for primary keys where appropriate
- Include created_at, updated_at timestamps
- Define clear foreign key relationships
- Support soft deletes where appropriate
- Consider future scalability

üîí **Security (RLS Policies):**
- Follow existing RLS patterns from users/messages tables
- Users can view all active projects (SELECT policy)
- Users can create projects (INSERT: authenticated users only)
- Users can update/delete OWN projects (UPDATE/DELETE: auth.uid() = created_by)
- Admins can manage all projects (admin role check)
- Applications: owners see applications TO their projects, applicants see their OWN applications
- Favorites: users can only manage their own favorites
- Ratings: users can only rate if they participated, can edit own ratings

‚öôÔ∏è **RPC Functions:**
- Follow pattern of admin_create_complete_user()
- create_project_with_validation(project_data jsonb) ‚Üí validates and creates
- apply_to_project(project_id uuid, application_data jsonb) ‚Üí prevents duplicates
- update_application_status(application_id uuid, new_status text) ‚Üí owner only
- toggle_favorite(project_id uuid) ‚Üí add/remove favorite
- submit_rating(project_id uuid, rating int, review text) ‚Üí with participation check
- get_project_with_details(project_id uuid) ‚Üí returns project + owner + stats
- search_projects(filters jsonb) ‚Üí advanced search with multiple criteria
- get_my_projects_dashboard() ‚Üí user's projects + applications + favorites
- get_matching_projects(user_id uuid) ‚Üí based on user skills

üé® **Frontend Components (Vue 3 + Vuestic):**
- pages/projects/ProjectListingsPage.vue (browse all projects)
- pages/projects/ProjectDetailPage.vue (single project view)
- pages/projects/CreateProjectPage.vue (new project form)
- pages/projects/MyProjectsPage.vue (user's created projects)
- pages/projects/MyApplicationsPage.vue (user's applications)
- pages/projects/FavoritesPage.vue (favorited projects)
- components/projects/ProjectCard.vue (project preview card)
- components/projects/ProjectApplicationForm.vue
- components/projects/ApplicationsList.vue (for project owners)
- components/projects/RatingDisplay.vue
- components/projects/RatingForm.vue
- components/notifications/NotificationDropdown.vue
- components/notifications/NotificationsList.vue

üì¶ **Pinia Stores:**
- stores/projects.ts (CRUD for projects, extend existing?)
- stores/project-applications.ts (apply, update status, list)
- stores/favorites.ts (toggle, list)
- stores/ratings.ts (submit, list)
- stores/notifications.ts (fetch, mark read, realtime updates)

üîå **API Services (TypeScript):**
- services/api/projects.service.ts
- services/api/applications.service.ts
- services/api/favorites.service.ts
- services/api/ratings.service.ts
- services/api/notifications.service.ts
- Follow pattern from services/api/auth.service.ts

üìù **TypeScript Types:**
- types/projects.types.ts (all project-related interfaces)
- Extend existing types, don't duplicate User types

üß™ **Postman Collection:**
- Add new section to starting_point.json
- Follow exact same pattern as existing sections
- Include tests with pm.test()
- Use {{variables}} for dynamic data
- Include descriptions in Turkish + English
- Test scenarios: create project, apply, favorite, rate, etc.
- Test RLS policies (user can't delete others' projects)

üì° **Realtime (Optional but Recommended):**
- Enable Realtime for notifications table
- Subscribe to new applications in real-time
- Subscribe to project updates
- Subscribe to new messages

---

SPECIFIC REQUIREMENTS:

Database Tables to Create:
1. projects (id, title, description, field_type, required_skills[], contact_info, 
   start_date, end_date, created_by, status, is_active, view_count, created_at, updated_at)

2. project_applications (id, project_id, user_id, message, status, cv_link, 
   relevant_skills[], created_at, updated_at)

3. favorites (id, project_id, user_id, created_at)

4. project_ratings (id, project_id, user_id, rating, review_text, created_at, updated_at)

5. notifications (id, user_id, type, title, message, project_id, application_id, 
   read, created_at)

6. project_participants (id, project_id, user_id, role: owner/member, joined_at)

Field Types Enum:
- M√ºhendislik (Engineering)
- Saƒülƒ±k (Health)
- Eƒüitim (Education)
- Teknoloji (Technology)
- Sanat (Arts)
- Bilim (Science)
- Other

Application Status Enum:
- pending
- accepted
- rejected
- withdrawn

Notification Type Enum:
- new_application
- application_accepted
- application_rejected
- new_message
- favorite_project_update
- deadline_approaching
- matching_project

---

DELIVERABLES NEEDED:

1. **Complete SQL Schema File** (database-extension.sql)
   - All CREATE TABLE statements
   - All CREATE TYPE (enums) statements
   - All foreign keys and indexes
   - All RLS policies
   - All RPC functions
   - All triggers (if needed)
   - Migration notes (safe to run on existing database)

2. **TypeScript Interfaces** (types/projects.types.ts)
   - All interfaces matching database schema
   - Request/Response types for API
   - Form types for Vue components

3. **API Service Layers** (services/api/*.service.ts)
   - Full CRUD operations
   - Follow auth.service.ts patterns
   - Proper error handling
   - TypeScript types

4. **Pinia Stores** (stores/*.ts)
   - State management
   - Actions for all operations
   - Getters for computed data

5. **Vue Components** (pages + components)
   - Component structure and props
   - Key functionality outline
   - Vuestic UI components to use

6. **Postman Collection Extension** (starting_point.json additions)
   - Complete test scenarios
   - All endpoints documented
   - Turkish + English descriptions

7. **Implementation Guide** (IMPLEMENTATION-PLAN.md)
   - Step-by-step implementation order
   - Testing checklist
   - Deployment notes

---

CRITICAL CONSTRAINTS:

‚ùó MUST maintain backward compatibility with existing features
‚ùó MUST follow existing naming conventions and patterns
‚ùó MUST include proper RLS policies (security first)
‚ùó MUST prevent duplicate applications (user can't apply twice to same project)
‚ùó MUST handle race conditions (concurrent favorites, applications)
‚ùó MUST validate data (required fields, email format, date ranges)
‚ùó MUST include soft deletes for projects (don't actually delete, mark inactive)
‚ùó MUST support pagination for all list endpoints
‚ùó MUST include comprehensive error handling
‚ùó MUST work with existing starting_point.json Postman testing pattern

---

GITHUB COPILOT INSTRUCTIONS:

Please create a comprehensive project plan that breaks this down into:

1. **EPICS** (major feature groups)
2. **FEATURES** (specific capabilities within epics)
3. **TASKS** (atomic implementation steps)

For each task, include:
- Clear description
- Technical requirements
- Code snippets/examples where helpful
- Dependencies on other tasks
- Estimated complexity (simple/medium/complex)
- Testing requirements

Organize the plan to allow incremental implementation and testing at each stage.

Focus on practical, production-ready code that extends the existing system cleanly.
```

---

## üìù USAGE INSTRUCTIONS

1. ‚úÖ Complete export of current Supabase state
2. ‚úÖ Fill in CURRENT-STATE-FOR-COPILOT.md with all exports
3. ‚úÖ Copy this entire prompt
4. ‚úÖ Replace `[PASTE ENTIRE CONTENT OF CURRENT-STATE-FOR-COPILOT.md HERE]` with actual content
5. ‚úÖ Open GitHub Copilot Chat
6. ‚úÖ Attach your repository
7. ‚úÖ Paste the complete prompt
8. ‚úÖ Wait for Copilot to generate the epic/feature/task breakdown

---

## üéØ EXPECTED OUTPUT

Copilot should generate:
- Epic 1: Database Schema & RLS Setup
  - Feature 1.1: Create projects table
    - Task 1.1.1: Define schema
    - Task 1.1.2: Add RLS policies
    - Task 1.1.3: Create indexes
  - Feature 1.2: Create applications table
    - ...

- Epic 2: RPC Functions & Business Logic
  - Feature 2.1: Project creation function
  - Feature 2.2: Application management functions
  - ...

- Epic 3: TypeScript Types & Interfaces
  - ...

- Epic 4: API Service Layer
  - ...

- Epic 5: Pinia State Management
  - ...

- Epic 6: Vue Components
  - ...

- Epic 7: Postman Collection Testing
  - ...

- Epic 8: Frontend Integration
  - ...

Each with detailed implementation steps!
